const { choice, feedback } = req.body
  const timestamp = new Date().toLocaleString("vi-VN", { timeZone: "Asia/Ho_Chi_Minh" })

  if (!choice) {
    return res.status(400).send("Lá»±a chá»n khÃ´ng há»£p lá»‡.")
  }

  // Log to console for local development
  console.log("\nğŸ‰ NEW RESPONSE RECEIVED:")
  console.log("â° Time:", timestamp)
  console.log("ğŸ’ Choice:", choice === "yes" ? "âœ… Äá»’NG Ã!" : "âŒ KhÃ´ng...")
  console.log("ğŸ’­ Feedback:", feedback || "KhÃ´ng cÃ³ pháº£n há»“i")
  console.log("â”€".repeat(50))

  try {
    // Try to save to Google Sheets if configured
    if (sheets && SPREADSHEET_ID) {
      await sheets.spreadsheets.values.append({
        spreadsheetId: SPREADSHEET_ID,
        range: "result_cr!A:C",
        valueInputOption: "USER_ENTERED",
        resource: {
          values: [[timestamp, choice, feedback || ""]],
        },
      })
      console.log("âœ… Response saved to Google Sheets")
    }
=======
app.post("/submit-response", async (req, res) => {
  const { choice, feedback } = req.body
  const timestamp = new Date().toLocaleString("vi-VN", { timeZone: "Asia/Ho_Chi_Minh" })

  if (!choice) {
    return res.status(400).send("Lá»±a chá»n khÃ´ng há»£p lá»‡.")
  }

  // Extract IP address
  const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress || req.ip || "Unknown IP"
  // Extract User-Agent (device info)
  const userAgent = req.headers['user-agent'] || "Unknown Device"

  // Log to console for local development
  console.log("\nğŸ‰ NEW RESPONSE RECEIVED:")
  console.log("â° Time:", timestamp)
  console.log("ğŸ’ Choice:", choice === "yes" ? "âœ… Äá»’NG Ã!" : "âŒ KhÃ´ng...")
  console.log("ğŸ’­ Feedback:", feedback || "KhÃ´ng cÃ³ pháº£n há»“i")
  console.log("ğŸŒ IP Address:", ip)
  console.log("ğŸ“± Device Info:", userAgent)
  console.log("â”€".repeat(50))

  try {
    // Try to save to Google Sheets if configured
    if (sheets && SPREADSHEET_ID) {
      await sheets.spreadsheets.values.append({
        spreadsheetId: SPREADSHEET_ID,
        range: "result_cr!A:E",
        valueInputOption: "USER_ENTERED",
        resource: {
          values: [[timestamp, choice, feedback || "", ip, userAgent]],
        },
      })
      console.log("âœ… Response saved to Google Sheets")
    }
